<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Modify Resources - Concordia Resource Manager</title>
  <link rel="stylesheet" href="dashboard.css">
  <style>
    .portal-content { display:flex; flex-direction:column; align-items:center; gap:2rem; padding:2%; }
    .resource-grid { display:grid; grid-template-columns:1fr 1fr; gap:2rem; width:90%; max-width:1000px; }
    .resource-box { display:flex; flex-direction:column; justify-content:space-between; border:1px solid lightgray; border-radius:10px; overflow:hidden; background:#f9f9f9; min-height:300px; }
    .resource-title { background:var(--main-color); color:#fff; text-align:center; padding:10px; font-weight:bold; font-size:1.3rem; }
    .resource-content { flex:1; overflow:auto; padding:10px; }
    .resource-button { background:var(--secondary-color); border:none; cursor:pointer; font-size:1.5rem; padding:10px; transition:background-color .2s ease; }
    .resource-button:hover { background:var(--hover-color); color:#000; }
    .equipment-box { grid-column:1 / span 2; justify-self:center; width:50%; }

    .resource-list { list-style:none; padding:0; margin:0; display:grid; gap:.5rem; }
    .resource-item { padding:0; border-radius:6px; overflow:hidden; }
    .resource-link {
      display:flex; align-items:center; gap:.5rem; padding:.5rem .75rem;
      border:1px solid lightgray; border-radius:6px; background:#fff; text-decoration:none; color:inherit;
    }
    .resource-link:hover { background:#f6f6f6; }
    .thumb { width:28px; height:28px; object-fit:cover; border-radius:4px; border:1px solid #ddd; display:grid; place-items:center; font-size:12px; }
    .badge { font-size:.75rem; padding:.15rem .5rem; border-radius:999px; border:1px solid #ccc; }
    .avail-yes { color:#0b5ed7; }  /* Available */
    .avail-no  { color:#c82333; }  /* Unavailable */
  </style>
</head>
<body>
<form class="manage-profile" id="manageProfile" role="dialog" aria-modal="true" aria-labelledby="manageProfileTitle" hidden>
  <div class="mp-card" role="document">
    <div class="mp-header">
      <h2 id="manageProfileTitle">Manage Profile</h2>
      <button type="button" class="mp-close" id="mpClose" aria-label="Close">&times;</button>
    </div>
    <div class="mp-body">
      <div class="mp-row mp-avatar">
        <img id="mpAvatarPreview" src="../resources/avatar.jpg" alt="Avatar preview">
      </div>
      <div class="mp-field">
        <label for="mpDisplayName">Display Name</label>
        <input id="mpDisplayName" name="displayname" type="text" maxlength="80" />
      </div>
      <div class="mp-field">
        <label for="mpEmail">Email</label>
        <input id="mpEmail" name="email" type="email" />
      </div>
    </div>
    <div class="mp-footer">
      <button type="button" id="mpCancel">Cancel</button>
      <button type="submit" id="mpSave">Save</button>
    </div>
  </div>
</form>

<div class="center">
  <div id="banner"><img src="../resources/concordia.png" alt="Concordia"></div>
  <h2 id="title">Modify Resources</h2>

  <aside class="sidebar">
    <form class="sidebar-buttons" action="dashboard.html" method="get">
      <button id="dashboard" type="submit">Dashboard</button>
      <button id="manage" class="sidebar-buttons-current-page" type="submit" formaction="modify.html">Modify Resources</button>
      <button id="view" type="submit" formaction="requests.html" formmethod="get">Active Requests</button>
      <!-- Data Analysis removed - embedded in dashboard -->
    </form>
    <div class="sidebar-deadspace"></div>
    <button class="profile-button">
      <div id="avatar"><img id="avatar-img" src="../resources/avatar.jpg" alt=""></div>
      <div id="profile-name"><p id="displayname">[Display Name]</p><p id="email">[email@domain.gg]</p></div>
    </button>
  </aside>

  <main class="portal">
    <h3 id="portal-title">Resource Categories</h3>

    <div class="portal-content">
      <div class="resource-grid">
        <!-- Study Rooms -->
        <div class="resource-box">
          <div class="resource-title">Study Rooms</div>
          <div class="resource-content">

            <ul class="resource-list" id="study-list">
  <!-- Filled by JavaScript -->
</ul>
          </div>
          <button class="resource-button" type="button" onclick="goCreate('study')">+</button>
        </div>

        <!-- Labs -->
        <div class="resource-box">
          <div class="resource-title">Labs</div>
          <div class="resource-content">

            <ul class="resource-list" id="lab-list">
  <!-- Filled by JavaScript -->
</ul>
          </div>
          <button class="resource-button" type="button" onclick="goCreate('lab')">+</button>
        </div>

        <!-- Equipment -->
        <div class="resource-box equipment-box">
          <div class="resource-title">Equipment</div>
          <div class="resource-content">

            <ul class="resource-list" id="equipment-list">
  <!-- Filled by JavaScript -->
</ul>
          </div>
          <button class="resource-button" type="button" onclick="goCreate('equipment')">+</button>
        </div>
      </div>
    </div>
  </main>
</div>

<footer class="footer"><h3>footer</h3></footer>

<script>
  const API_BASE = 'http://localhost:8000';

  function goCreate(type){
    location.href = `create.html?type=${encodeURIComponent(type)}`;
  }

  function createListItem(resource, typeKey) {
    const li = document.createElement('li');
    li.className = 'resource-item';

    const available = !!resource.available;
    const availClass = available ? 'avail-yes' : 'avail-no';
    const availText = available ? 'Available' : 'Unavailable';

    li.innerHTML = `
      <a class="resource-link"
         href="edit.html?type=${encodeURIComponent(typeKey)}&id=${encodeURIComponent(resource.id)}">
        <div class="thumb" aria-hidden="true"></div>
        <strong>${resource.name}</strong>
        <span style="flex:1;"></span>
        <span class="badge ${availClass}">${availText}</span>
      </a>
    `;
    return li;
  }

  async function loadCategory(typeKey, ulId, resourcePath) {
    const listEl = document.getElementById(ulId);
    if (!listEl) return;
    listEl.innerHTML = '<li>Loadingâ€¦</li>';

    try {
      const res = await fetch(`${API_BASE}/admin/${resourcePath}`);
      if (!res.ok) {
        listEl.innerHTML = '<li>Failed to load.</li>';
        return;
      }
      const items = await res.json();
      listEl.innerHTML = '';
      if (!items.length) {
        listEl.innerHTML = '<li>No resources found.</li>';
        return;
      }
      for (const r of items) {
        listEl.appendChild(createListItem(r, typeKey));
      }
    } catch (err) {
      console.error(err);
      listEl.innerHTML = '<li>Network error.</li>';
    }
  }

  function initResourceLists(){
    // Study Rooms
    loadCategory('study', 'study-list', 'rooms');
    // Labs
    loadCategory('lab', 'lab-list', 'labs');
    // Equipment
    loadCategory('equipment', 'equipment-list', 'equipment');
  }

  window.addEventListener('DOMContentLoaded', initResourceLists);
</script>
<script src="manage-profile.js"></script>
</body>
</html>
